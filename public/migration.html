<!DOCTYPE html>
<title></title>
<meta charset="utf-8">
<script src="https://unpkg.com/dexie@2.0.4/dist/dexie.js"></script>
<script>
	const db = new Dexie("status");
	db.version(1).stores({
		views: "target",
		characters: "uuid",
		profiles: "uuid",
		attributes: "uuid",
		skills: "uuid",
		items: "uuid",
		histories: "uuid",
	});

	window.addEventListener('message', event => {
		if (event.origin === "https://f-space.github.io") {
			try {
				const { views, characters, histories } = JSON.parse(event.data);

				Promise.all([
					db.views.bulkPut(views),
					db.characters.bulkPut(characters),
					db.histories.bulkPut(histories),
				]).then(() => {
					event.source.postMessage("", event.origin);
				}).catch(e => {
					event.source.postMessage(e.message, event.origin);
				});
			} catch (e) {
				event.source.postMessage(e.message, event.origin);
			}
		}
	});
</script>